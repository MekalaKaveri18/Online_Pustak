pipeline {
    agent any

    stages {
        stage('Preparation') {
            steps {
                echo 'Cloning repository...'
                git branch: 'master', url: 'https://github.com/jglick/simple-maven-project-with-tests.git'
            }
        }

        stage('Backend Build') {
            steps {
                dir('backend') { // adjust if backend folder is different
                    echo 'Building ASP.NET Core Backend...'
                    bat 'dotnet restore'
                    bat 'dotnet build --configuration Release'
                }
            }
        }

        stage('Frontend Build') {
            steps {
                dir('src') { // Angular frontend folder
                    echo 'Building Angular Frontend...'
                    bat 'npm install'
                    bat 'npm run build --prod'
                }
            }
        }

        stage('Tests') {
            parallel {
                stage('Backend Tests') {
                    steps {
                        dir('backend') {
                            echo 'Running Backend Unit Tests...'
                            bat 'dotnet test --configuration Release'
                        }
                    }
                }
                stage('Frontend Tests') {
                    steps {
                        dir('src') {
                            echo 'Running Frontend Unit Tests...'
                            bat 'npm test'
                        }
                    }
                }
            }
        }

        stage('Package & Archive') {
            steps {
                echo 'Archiving build artifacts...'
                archiveArtifacts artifacts: '**/bin/Release/**', fingerprint: true
                archiveArtifacts artifacts: 'src/dist/**', fingerprint: true
            }
        }

        stage('Deploy') {
            steps {
                echo 'Deploy step can be added here (IIS / Docker / Cloud)...'
            }
        }
    }
}
